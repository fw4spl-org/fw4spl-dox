<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>fw4spl: fwJobs library system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fw4spl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Jobs.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespacefwJobs.html" title="This namespace fwJobs provides jobs management. ">fwJobs</a> library system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#JobElements">Job elements</a><ul><li class="level2"><a href="#States">States</a></li>
<li class="level2"><a href="#WorkUnits">Work units</a></li>
<li class="level2"><a href="#Hooks">Hooks</a></li>
</ul>
</li>
<li class="level1"><a href="#KindsOfJobs">Kinds of jobs</a><ul><li class="level2"><a href="#Job">Job</a></li>
<li class="level2"><a href="#Observer">Observer</a></li>
<li class="level2"><a href="#Aggregator">Aggregator</a></li>
</ul>
</li>
<li class="level1"><a href="#ThreadSafe">Thread safe</a></li>
<li class="level1"><a href="#Tips">Tips</a><ul><li class="level2"><a href="#ProgressionReduced">Reducing the progression</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="el" href="namespacefwJobs.html" title="This namespace fwJobs provides jobs management. ">fwJobs</a> library is meant to trace progress of tasks.</p>
<h1><a class="anchor" id="JobElements"></a>
Job elements</h1>
<p>Each job is composed of several elements in order to be run, to trace its run, and to plan what it could do at different events of its life.</p>
<p>Moreover, each job has a name (generally named after the task he traces). Several logs can be added during job's life if the user wants to add details on the progression.</p>
<h2><a class="anchor" id="States"></a>
States</h2>
<p>A job has several life states:</p><ul>
<li>Waiting: The job is ready to be used,</li>
<li>Running: The job is currently running,</li>
<li>Canceling: The job received a cancel request,</li>
<li>Canceled: The job is canceled,</li>
<li>Finished: The job have finished to run his task.</li>
</ul>
<pre class="fragment">*          +-------------------------------------------
*          |                                          |
*          |                                          v
*          |                      +---------+     +--------+
*          |               +-----&gt;|Canceling|----&gt;|Canceled|
*          |               |      +---------+     +--------+
*     +-------+     +-------+                          |
*     |Waiting|----&gt;|Running|                          |
*     +-------+     +-------+                          v
*                         |       +--------+         +--+
*                         +------&gt;|Finished|--------&gt;|  |
*                                 +--------+         +--+
* </pre><p>A job is running until it is finished or canceled. </p><dl class="section warning"><dt>Warning</dt><dd>Therefore, a job can only be run once.</dd></dl>
<h2><a class="anchor" id="WorkUnits"></a>
Work units</h2>
<p>A job owns a number of total work units and a number of done work units. Work units are used to trace job's progress. The number of total work units is meant to be set before the job is running. The number of done work units updates while the job is running. Thus, progress is equal to: Done work units / Total work units. When the job is finished, the number of done work units is equal to the number of total work units.</p>
<h2><a class="anchor" id="Hooks"></a>
Hooks</h2>
<p>After an event (job's cancellation, log added etc.), it can be useful to perform commands.</p>
<p>In each job, the user can hook the following events:</p><ul>
<li>Cancellation,</li>
<li>State change,</li>
<li>Done work unit change,</li>
<li>Total work unit change,</li>
<li>Log change.</li>
</ul>
<p>There can be several hooks set to one event.</p>
<dl class="section warning"><dt>Warning</dt><dd>Do not get confused by hooks methods (which add callbacks to hooks) and callbacks helpers: methods that returns a callback which can be used to modify the job. For instance progressCallback returns a callback which modify done work units of the job.</dd></dl>
<h1><a class="anchor" id="KindsOfJobs"></a>
Kinds of jobs</h1>
<p>Three different kinds of job exist to allow the user to trace progress of a task in every situation.</p>
<h2><a class="anchor" id="Job"></a>
Job</h2>
<p>A Job encapsulates a task and trace its progress.</p>
<p>A Job has one important element: a function, in which are instructions to process the task and also instructions for the Job's progress. It can also have an optionnal worker on which the function will be run.</p>
<p>When the progress is complete, that is to say the number of done work units has reached the number of total work units, the job is immediately marked as finished.</p>
<p>Here is an example of Job use: </p><pre class="fragment">   ::fwJobs::Job::sptr job = ::fwJobs::Job::New( "Example of Job",
       [=](::fwJobs::Job&amp; runningJob)
       {
           for( std::size_t i = 1; i&lt;= 100; ++i)
           {
               if(runningJob.cancelRequested())
               {
                   break;
               }

               ::boost::this_thread::sleep_for( ::boost::chrono::milliseconds(1000) );

               runningJob.doneWork(i);
           }
       },
       worker
       );

   job.run().wait();

* </pre><p>A Job is initialized with a function taking a job as parameter. This Job is actually the Job itself.</p>
<p>In this example, the task is to wait 100 seconds. Every second, the job progress is updated with the method donework(). The method cancelRequested() allows to know inside the lambda if cancel has been requested while running.</p>
<p>At the end, the job is run to perform the task.</p>
<p>Job's progress and cancellation are feasible by other means: </p><pre class="fragment">   ::fwJobs::Job::sptr job = ::fwJobs::Job::New( "VTK Mesh reader",
       [=](::fwJobs::Job&amp; runningJob)
       {
           ::fwVtkIO::MeshWriter::sptr writer = ::fwVtkIO::MeshWriter::New();

           runningJob.addSimpleCancelHook( [=]{ writer-&gt;cancel(); });

           writer-&gt;setProgressCallback( runningJob.progressCallback() );

           writer-&gt;setObject(mesh);
           writer-&gt;setFile("file.vtk"));
           writer-&gt;write();
       },
       m_associatedWorker
       );

   job.run().wait();

* </pre><p>Here, Job's progress is updated through a done work callback: this function set the number of done work units of the Job. This callback needs only the number of done work units to set. The callback is set to the writer for using it during write() and updates Job's progress.</p>
<p>Here, another method is used to cancel the task: addSimpleCancelHook(). If the Job is canceling, the lambda inside is run and cancels the write.</p>
<h2><a class="anchor" id="Observer"></a>
Observer</h2>
<p>An Observer does not encapsulate a task but simply observe its progress.</p>
<p>An Observer is run immediately after it is initialized but must be finished by using the method finish().</p>
<p>Observer are generally used where progress is already given by an external source. This is shown in the following example: </p><pre class="fragment">   ::fwJobs::Observer observer =  ::fwJobs::Observer::New("VTK Image reader");

   vtkSmartPointer&lt;vtkLambdaCommand&gt; progressCallback = vtkSmartPointer&lt;vtkLambdaCommand&gt;::New();
   progressCallback-&gt;SetCallback( [this](vtkObject* caller, long unsigned int , void* )
                                  {
                                      auto filter = static_cast&lt;vtkGenericDataObjectReader*&gt;(caller);
                                      observer-&gt;doneWork( filter-&gt;GetProgress()*100 );
                                  }
                                );

   reader-&gt;AddObserver(vtkCommand::ProgressEvent, progressCallback);

   observer-&gt;addSimpleCancelHook( [&amp;](){
                                   reader-&gt;AbortExecuteOn();
                                   } );

   reader-&gt;Update();

   observer-&gt;finish();

* </pre><p>Here, the progress is given by the reader (here filter). The method doneWork() is embedded in the reader through a callback. Moreover, the method addSimpleCancelHook() allows to cancel the process.</p>
<p>The whole progress process is thus done during Update().</p>
<h2><a class="anchor" id="Aggregator"></a>
Aggregator</h2>
<p>An Aggregator aggregate IJobs (Jobs, Observers and Aggregator) in order to gather their progress into one.</p>
<p>The number of work units owned by a job in an Aggregator is set to 100. For instance, two jobs are present in an Aggregator. Job1 has 3 total work units and job2 has 1000 total work units. Thus the Aggregator's number of total work units is 200. 100 work units for job1 and 100 for jobs2.</p>
<p>When adding a job to an Aggregator, an associated weight can be linked to this job. It will determine the number of work units the job takes in the Aggregator by multiplying the weight by 100 (number of work units for each job in an Aggregator). The default weight is 1. For instance, with previous job1 and job2, job1 is added to the Aggregator with a weight of 3. The Aggregator's number ot total work units is 400. 100*3 for job1 and 100 for job2. Though, it is not recommended to use a weight lower than 0.01.</p>
<p>Moreover, when adding a job to an Aggregator, job's method cancel() is added to the Aggregator through a cancel callback. Thus, when the Aggregator is cancelled, each of its subjobs are cancelled as well.</p>
<p>Like a Job, an Aggregator must be run and is automatically marked as finished when its progress is completed. When an Aggregator is run, it calls each subjobs' run(). The Aggregator's progress is updated when a subjob's progress is changed.</p>
<p>Below, an example of Aggregator use: </p><pre class="fragment">   ::fwJobs::Aggregator::sptr = ::fwJobs::Aggregator::New("Example of Aggregator");

   m_job-&gt;add(m_subAggregator);
   m_job-&gt;add(m_subObserver, 3);
   m_job-&gt;add(m_subJob);

   m_job-&gt;run().wait();

* </pre><h1><a class="anchor" id="ThreadSafe"></a>
Thread safe</h1>
<p><a class="el" href="namespacefwJobs.html" title="This namespace fwJobs provides jobs management. ">fwJobs</a> library is thread safe. A worker can be set to a Job.</p>
<h1><a class="anchor" id="Tips"></a>
Tips</h1>
<h2><a class="anchor" id="ProgressionReduced"></a>
Reducing the progression</h2>
<p>A progression is not supposed to regress. It can lead to strange behaviors on <a class="el" href="namespacefwJobs.html" title="This namespace fwJobs provides jobs management. ">fwJobs</a> front end. Some misuse of the library can lead to this situation. These misuses are:</p><ul>
<li>Add a job to an Aggregator while it is running,</li>
<li>Change the total of work units while the job is running,</li>
<li>Set a lower number of done work units to a job.</li>
</ul>
<p>It is therefore strongly recommended to be careful when using actions that can possibly change the job's number of total work units before the execution of the process. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 10 2016 10:18:15 for fw4spl by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
